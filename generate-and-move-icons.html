<!DOCTYPE html>
<html lang="en">

<head>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300&display=swap" rel="stylesheet">
    <meta charset="utf-8">
    <title>scale monday</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <style>
        #graph {
            margin: auto;
            width: 600px;
            border: 3pm solid black;
        }

        #tooltip {
            position: absolute;
            width: auto;
            height: auto;
            padding: 10px;
            background-color: white;
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
            -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            -moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            pointer-events: none;
        }

        #tooltip.hidden {
            display: none;
        }

        #tooltip p {
            margin: 0;
            font-family: sans-serif;
            font-size: 16px;
            line-height: 20px;
        }
    </style>
</head>

<body>
    <div id="graph"></div>

    <div id="tooltip" class="hidden">
        <p><span id="value">100</span></p>
    </div>

    <script type="text/javascript">

        var padding = 20
        var w = 600
        var h = 1
        var xRect = 50
        var yRect = 300 + padding

        // scalable: determine fulcrum height based on width of rect,
        // = rcos45, where r is radius, w/2
        // then subtract 1 pixel because it looks better
        var fulcrumHeight = w / 2 * (Math.cos(Math.PI / 4)) - 1
        var rectTargetAngle = 0
        var yClickHereToDropWeight = yRect + h - 5

        //this number is the "choose your billionaire" variable being fed in
        var billionaireWorth = 70300000000

        // if time: make a counter so that
        // as more weight is added, the counter alters the text
        // e.g. feed nyc SNAP recipients for 1 yr... 2 yrs... 3 yrs... 
        // counts up as you drop the weights?

        // will be fed in from Sharvari's selection oage
        var billiName = "MARK ZUCKERBERG"

        //this number is the other variable to compare to, also fed in
        var compareWorth = 2762628933
        var compareName = "GDP OF LIBERIA"

        // initialize "bigger" and "smaller variables" as 0 and sides as blank
        var bigger = 0
        var smaller = 0
        var smallSide = "?"
        var bigSide = "?"
        var smallLabel = "blank"

        // compare the two values and decide which is bigger, and which side will have multiple icons
        if (billionaireWorth > compareWorth) {
            var bigger = billionaireWorth; var smaller = compareWorth;
            var smallSide = "R"; var bigSide = "L"; var smallLabel = compareName
        }
        else { var bigger = compareWorth; var smaller = billionareWorth; var smallSide = "L"; var bigSide = "R"; var smallLabel = billiName }

        // determine the ratio between the variables
        compareRatio = Math.ceil(bigger / smaller)
        console.log(compareRatio)

        // to make the comparison scalable, create scale with the bigger number as upper limit
        // scale to jeff bezos' worth?
        var compareScale = d3.scaleLinear()
            .domain([0, bigger])
            .range([0, 45]);

        var iconRadiusScale = d3.scaleLinear()
            .domain([0, bigger])
            .range([5, 70]);


        var svg = d3.select("#graph").append("svg")
            .attr("width", 1000)
            .attr("height", 1000)
            .attr("yRect", 50);

        // draw the rectangle that turns
        svg.append('rect')
            .attr('x', xRect)
            .attr('y', yRect)
            .attr('width', w)
            .attr('height', h)
            .attr('fill', "white")
            .attr("stroke-width", 2)
            .attr('stroke', "black");


        var stemHeight = 50
        var containerWidth = 100

        // draw center of scale
        var center = svg.append('circle')
            .attr("cx", w / 2 + xRect)
            .attr("cy", yRect + h / 2)
            .attr("fill", "black")
            .attr("r", 10)
            .on("mouseover", function () {
                d3.select(this).attr("fill", "red")
            })
            .on("mouseout", function () {
                d3.select(this).attr("fill", "black");
            })
            //When clicked, should select off-screen circles and
            // eventially make them fall onto the scale

            .on("click", function () {
                for (i = 0; i < compareRatio; i += 1) {
                    makeIcons(smaller, smallSide, smallLabel, i);

                    turnRect(compareScale(smaller), smallSide)
                    turnRect(compareScale(bigger), bigSide)
                }
                d3.select("billiIcon")
                    .transition()
                    .attr("transform", "translate(0, 50)")

            })
            ;

        // draw the fulcrum = vertical center line
        var fulcrum = svg.append("line")
            .attr("x1", 50 + w / 2)
            .attr("y1", yRect + h)
            .attr("x2", 50 + w / 2)
            .attr("y2", yRect + h + fulcrumHeight)
            .attr("stroke-width", 2)
            .attr("stroke", "black");

        //draw the "floor" line
        var floor = svg.append("line")
            .attr("x1", 50)
            .attr("y1", yRect + h + fulcrumHeight)
            .attr("x2", 50 + w)
            .attr("y2", yRect + h + fulcrumHeight)
            .attr("stroke-width", 2)
            .attr("stroke", "black");



        // call the makeIcons function for billionaire
        // specify sides "L" and "R" so billionaire is always on left side,
        // and comparison variable always on right.
        makeIcons(billionaireWorth, "L", billiName, 0)

        // define function to make icons
        function makeIcons(weight, side, label, i) {
            svg.append('circle')
                .attr("cx", function () {
                    // put billionaire icon on left side of screen
                    if (side == "L") {
                        return xRect + 5 * padding + iconRadiusScale(weight) / 2
                    }
                    // put comparison icon on right side of screen
                    else { return xRect + w - 5 * padding - iconRadiusScale(weight) / 2 + i % 5 * 2 * (iconRadiusScale(weight)) }
                })
                // assign each icon an ID
                .attr("id", function () {
                    if (side == "L") {
                        // the billionaire gets its own unique id
                        return "billiIcon"
                    }
                    // the comparison icons get numbered ids like "compareIcon3"
                    else { return "compareIcon" + i }
                })
                .attr("cy", Math.floor(i / 5) * 2 * (iconRadiusScale(weight)))
                // or, if u want them off screen the whole time:
                // .attr("cy", - iconRadiusScale(bigger))
                // for now, lets keep them on screen so we can be sure they are getting generated correctly
                .attr("fill", "gold")
                .attr("r", iconRadiusScale(weight))
                .on("click", function () {
                    d3.select(this)
                    console.log(this.id)
                })

            d3.select("#compareIcon" + i)
                .transition()
                // trying to delay them falling at their own individual randomized times
                .delay(1000 * Math.random())
                .duration(1000)
                // put fill to blue as a test to see if this code was executing and maybe it was just an issue with transform
                // but it wasnt, which makes me think it's a selection issue
                .attr("fill", "blue")
                .attr("transform", "translate(0,400)")//!!here i just put some numbers for moving it and it works just as you wrote it before
        };


        function turnRect(angle, side) {
            if (side == "L") {
                rectTargetAngle = rectTargetAngle - angle
            }
            else {
                rectTargetAngle = rectTargetAngle + angle
            }
            // new local variable (not used outside function)
            let rectDisplayAngle = rectTargetAngle;
            // make max rotation of 45 degrees, so it doesnt go through the "floor"
            if (rectDisplayAngle > 45) rectDisplayAngle = 45
            if (rectDisplayAngle < -45) rectDisplayAngle = -45
            d3.select("#billiIcon")
                .transition()
                .duration(500)
                .attr("transform", "translate (0," + (iconRadiusScale(bigger) + yRect - iconRadiusScale(bigger) / 2) + ")");

            d3.select('rect')
                .transition()
                // delay programatically to start turning when ball hits?
                // make delay variable of time it would take for ball to translate down?
                .delay(500)
                .duration(5000)
                .attr("transform", "rotate(" + (rectDisplayAngle) + "," + (w / 2 + xRect) + "," + (yRect + h / 2) + ")")
            return rectTargetAngle

        }


    </script>
</body>

</html>